{% extends "core/base.html" %}

{% block title %}SIGEC | Balance Consolidado{% endblock %}

{% block header %}
<div style="display: flex; justify-content: space-between; align-items: center;">
    <div>
        <h2>Balance Consolidado</h2>
        <p>
            Visualiza el balance general consolidado de todas las sub-empresas
            {% if empresa_actual %}de <strong>{{ empresa_actual.nombre }}</strong>{% endif %}.
        </p>
    </div>
    <a href="#" class="btn" style="background-color: var(--color-text-dark); color: var(--color-white);">
        <i class="fas fa-file-pdf"></i> Exportar PDF
    </a>
</div>
{% endblock %}

{% block content %}
<div class="metric-grid">
    <div class="card" style="border-top: 4px solid var(--color-accent-green);">
        <h3>Total Activos</h3>
        <div class="value">
            ${{ total_activos|default:0 }}
        </div>
    </div>
    <div class="card" style="border-top: 4px solid var(--color-danger-red);">
        <h3>Total Pasivos</h3>
        <div class="value">
            ${{ total_pasivos|default:0 }}
        </div>
    </div>
    <div class="card" style="border-top: 4px solid var(--color-primary-blue);">
        <h3>Total Capital</h3>
        <div class="value">
            ${{ total_capital|default:0 }}
        </div>
    </div>
</div>

<div class="card"
     style="min-height: 350px; margin-bottom: 40px; text-align: center; display: flex; align-items: center; justify-content: center;">
    <p style="color: var(--color-text-light);">
        [Aquí más adelante irá el gráfico de barras de Activos, Pasivos y Capital por Sub-Empresa]
    </p>
</div>

<div class="card">
    <h3>Balance General Detallado</h3>
    <div class="table-container">
        <table>
            <thead>
            <tr>
                <th>Sub-Empresa</th>
                <th>Activos ($)</th>
                <th>Pasivos ($)</th>
                <th>Capital ($)</th>
                <th>Ratio A/P</th>
            </tr>
            </thead>
            <tbody>
            {% if balance_detallado %}
                {% for fila in balance_detallado %}
                    <tr>
                        <td>{{ fila.subempresa.nombre }}</td>
                        <td>{{ fila.activos }}</td>
                        <td>{{ fila.pasivos }}</td>
                        <td>{{ fila.capital }}</td>
                        <td>{{ fila.ratio_ap|floatformat:2 }}</td>
                    </tr>
                {% endfor %}
                <tr style="font-weight: 600; background-color: #F3F4F6;">
                    <td>Total Consolidado</td>
                    <td>
                        {% if ratio_ap_total %}
                            {{ ratio_ap_total|floatformat:2 }}
                        {% else %}
                            –
                        {% endif %}
                    </td>
                    <td style="color: var(--color-accent-green);">
                        {{ total_activos }}
                    </td>
                    <td style="color: var(--color-danger-red);">
                        {{ total_pasivos }}
                    </td>
                    <td style="color: var(--color-primary-blue);">
                        {{ total_capital }}
                    </td>
                    <td>
                        {% if total_pasivos %}
                            {{ total_activos|divisibleby:total_pasivos }}
                        {% else %}
                            –
                        {% endif %}
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="5" style="text-align:center; color:var(--color-text-light);">
                        No hay información de balance disponible para el contexto seleccionado.
                    </td>
                </tr>
            {% endif %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
